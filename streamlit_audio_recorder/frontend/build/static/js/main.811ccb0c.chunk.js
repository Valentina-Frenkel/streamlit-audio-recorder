(this.webpackJsonpstreamlit_component_template=this.webpackJsonpstreamlit_component_template||[]).push([[0],{18:function(e,t,n){e.exports=n(33)},26:function(e,t,n){e.exports={test:"styles_test__2rKUN"}},33:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n.n(a),o=n(16),i=n.n(o),c=n(0),s=n(1),l=n(2),u=n(3),d=n(9),f=n(4),h=n.n(f),p=n(5),g=n(10),v=(n(26),n(27),n(28),Object.freeze({START:"start",PAUSE:"pause",STOP:"stop",NONE:"none"})),m=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).init=Object(p.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.leftchannel=[],a.rightchannel=[],a.recorder=null,a.recording=!1,a.recordingLength=0,a.volume=null,a.audioInput=null,a.sampleRate=null,a.AudioContext=window.AudioContext||window.webkitAudioContext,a.context=null,a.analyser=null,a.canvas=a.canvasRef.current,a.canvasCtx=a.canvas.getContext("2d"),a.stream=null,a.tested=!1,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;case 16:case"end":return e.stop()}}),e)}))),a.getStream=function(e){return e||(e={audio:!0,video:!1}),navigator.mediaDevices.getUserMedia(e)},a.setUpRecording=function(){a.context=new a.AudioContext,a.sampleRate=a.context.sampleRate,a.volume=a.context.createGain(),a.audioInput=a.context.createMediaStreamSource(a.stream),a.analyser=a.context.createAnalyser(),a.audioInput.connect(a.analyser);a.recorder=a.context.createScriptProcessor(2048,2,2),a.analyser.connect(a.recorder),a.recorder.connect(a.context.destination);var e=Object(g.a)(a);a.recorder.onaudioprocess=function(t){if(e.recording){var n=t.inputBuffer.getChannelData(0),a=t.inputBuffer.getChannelData(1);e.tested||(e.tested=!0,n.reduce((function(e,t){return e+t}))||(console.log("Error: There seems to be an issue with your Mic"),e.stop(),e.stream.getTracks().forEach((function(e){e.stop()})))),e.leftchannel.push(new Float32Array(n)),e.rightchannel.push(new Float32Array(a)),e.recordingLength+=2048}},a.visualize()},a.mergeBuffers=function(e,t){for(var n=new Float32Array(t),a=0,r=e.length,o=0;o<r;o++){var i=e[o];n.set(i,a),a+=i.length}return n},a.interleave=function(e,t){for(var n=e.length+t.length,a=new Float32Array(n),r=0,o=0;o<n;)a[o++]=e[r],a[o++]=t[r],r++;return a},a.writeUTFBytes=function(e,t,n){for(var a=n.length,r=0;r<a;r++)e.setUint8(t+r,n.charCodeAt(r))},a.visualize=function(){var e=a.props,t=e.backgroundColor,n=e.foregroundColor;if(a.WIDTH=a.canvas.width,a.HEIGHT=a.canvas.height,a.CENTERX=a.canvas.width/2,a.CENTERY=a.canvas.height/2,a.analyser){a.analyser.fftSize=2048;var r=a.analyser.fftSize,o=new Uint8Array(r);a.canvasCtx.clearRect(0,0,a.WIDTH,a.HEIGHT);var i=Object(g.a)(a);!function e(){i.drawVisual=requestAnimationFrame(e),i.analyser.getByteTimeDomainData(o),i.canvasCtx.fillStyle=t,i.canvasCtx.fillRect(0,0,i.WIDTH,i.HEIGHT),i.canvasCtx.lineWidth=2,i.canvasCtx.strokeStyle=n,i.canvasCtx.beginPath();for(var a=1*i.WIDTH/r,c=0,s=0;s<r;s++){var l=o[s]/128*i.HEIGHT/2;0===s?i.canvasCtx.moveTo(c,l):i.canvasCtx.lineTo(c,l),c+=a}i.canvasCtx.lineTo(i.canvas.width,i.canvas.height/2),i.canvasCtx.stroke()}()}},a.setupMic=Object(p.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.getStream();case 3:window.stream=a.stream=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("Error: Issue getting mic",e.t0);case 9:a.setUpRecording();case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),a.start=Object(p.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.setupMic();case 2:a.recording=!0,a.leftchannel.length=a.rightchannel.length=0,a.recordingLength=0,setInterval((function(){a.recording,console.log("Recording: ",a.recording),a.leftBuffer=a.mergeBuffers(a.leftchannel,a.recordingLength),a.rightBuffer=a.mergeBuffers(a.rightchannel,a.recordingLength);var e=a.interleave(a.leftBuffer,a.rightBuffer),t=new ArrayBuffer(44+2*e.length),n=new DataView(t);a.writeUTFBytes(n,0,"RIFF"),n.setUint32(4,44+2*e.length,!0),a.writeUTFBytes(n,8,"WAVE"),a.writeUTFBytes(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,2,!0),n.setUint32(24,a.sampleRate,!0),n.setUint32(28,4*a.sampleRate,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),a.writeUTFBytes(n,36,"data"),n.setUint32(40,2*e.length,!0);for(var r=e.length,o=44,i=0;i<r;i++)n.setInt16(o,32767*e[i],!0),o+=2;d.a.setComponentValue({arr:new Uint8Array(t)})}),1e3);case 6:case"end":return e.stop()}}),e)}))),a.stop=function(){var e=a.props,t=e.onStop,n=e.type;a.recording=!1,a.closeMic(),a.leftBuffer=a.mergeBuffers(a.leftchannel,a.recordingLength),a.rightBuffer=a.mergeBuffers(a.rightchannel,a.recordingLength);var r=a.interleave(a.leftBuffer,a.rightBuffer),o=new ArrayBuffer(44+2*r.length),i=new DataView(o);a.writeUTFBytes(i,0,"RIFF"),i.setUint32(4,44+2*r.length,!0),a.writeUTFBytes(i,8,"WAVE"),a.writeUTFBytes(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,2,!0),i.setUint32(24,a.sampleRate,!0),i.setUint32(28,4*a.sampleRate,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),a.writeUTFBytes(i,36,"data"),i.setUint32(40,2*r.length,!0);for(var c=r.length,s=44,l=0;l<c;l++)i.setInt16(s,32767*r[l],!0),s+=2;var u=new Blob([i],{type:n}),d=URL.createObjectURL(u);t&&t({blob:u,url:d,type:n})},a.pause=function(){a.recording=!1,a.closeMic()},a.resume=function(){a.setupMic(),a.recording=!0},a.closeMic=function(){a.stream.getAudioTracks().forEach((function(e){e.stop()})),a.audioInput.disconnect(0),a.analyser.disconnect(0),a.recorder.disconnect(0)},a.canvasRef=r.a.createRef(),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.state;this.checkState(e.state,n)}},{key:"checkState",value:function(e){switch(e){case v.START:this.doIfState(v.PAUSE,this.pause),this.doIfState(v.STOP,this.stop);break;case v.PAUSE:this.doIfState(v.START,this.resume),this.doIfState(v.STOP,this.stop);break;case v.STOP:default:this.doIfState(v.START,this.start)}}},{key:"doIfState",value:function(e,t){this.props.state==e&&t&&t()}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.canvasWidth,n=e.canvasHeight;return r.a.createElement("div",{className:"audio-react-recorder"},r.a.createElement("canvas",{ref:this.canvasRef,width:t,height:n,className:"audio-react-recorder__canvas"}))}}]),n}(r.a.Component);m.defaultProps={state:v.NONE,type:"audio/wav",backgroundColor:"rgb(200, 200, 200)",foregroundColor:"rgb(0, 0, 0)",canvasWidth:500,canvasHeight:300};var w=n(14),y=(n(32),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={isFocused:!1,recordState:null,audioDataURL:"",reset:!1},e.render=function(){var t=e.props.theme,n={},a=e.state.recordState;if(t){var o="1px solid ".concat(e.state.isFocused?t.primaryColor:"gray");n.border=o,n.outline=o}return r.a.createElement("span",null,r.a.createElement("div",null,r.a.createElement("button",{id:"record",onClick:e.onClick_start},"Start Recording"),r.a.createElement("button",{id:"stop",onClick:e.onClick_stop},"Stop"),r.a.createElement("button",{id:"reset",onClick:e.onClick_reset},"Reset"),r.a.createElement("button",{id:"continue",onClick:e.onClick_continue},"Download"),r.a.createElement(m,{state:a,onStop:e.onStop_audio,type:"audio/wav",backgroundColor:"rgb(255, 255, 255)",foregroundColor:"rgb(255,76,75)",canvasWidth:450,canvasHeight:100}),r.a.createElement("audio",{id:"audio",controls:!0,src:e.state.audioDataURL})))},e.onClick_start=function(){e.setState({reset:!1,audioDataURL:"",recordState:w.a.START}),d.a.setComponentValue("")},e.onClick_stop=function(){e.setState({reset:!1,recordState:w.a.STOP})},e.onClick_reset=function(){e.setState({reset:!0,audioDataURL:"",recordState:w.a.STOP}),d.a.setComponentValue("")},e.onClick_continue=function(){if(""!==e.state.audioDataURL){var t=(new Date).toLocaleString(),n="streamlit_audio_"+(t=(t=(t=t.replace(" ","")).replace(/_/g,"")).replace(",",""))+".wav",a=document.createElement("a");a.style.display="none",a.href=e.state.audioDataURL,a.download=n,document.body.appendChild(a),a.click()}},e.onStop_audio=function(t){!0===e.state.reset?(e.setState({audioDataURL:""}),d.a.setComponentValue("")):(e.setState({audioDataURL:t.url}),fetch(t.url).then((function(e){return e.blob()})).then((function(e){return new Response(e).arrayBuffer()})).then((function(e){d.a.setComponentValue({arr:new Uint8Array(e)})})))},e}return Object(c.a)(n)}(d.b)),U=Object(d.c)(y);d.a.setComponentReady(),d.a.setFrameHeight(),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.811ccb0c.chunk.js.map